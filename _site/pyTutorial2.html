<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.527">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>EPS7008-UFSC - Tutorial 2 - Pandas</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">EPS7008-UFSC</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-tutoriais-python" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Tutoriais Python</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-tutoriais-python">    
        <li>
    <a class="dropdown-item" href="./pyTutorialPython.html">
 <span class="dropdown-text">Tutorial de Instalação do Python</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./pyTutorial1.html">
 <span class="dropdown-text">Tutorial 1 - Pandas</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./pyTutorial2.html">
 <span class="dropdown-text">Tutorial 2 - Pandas</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./pyTutorial3.html">
 <span class="dropdown-text">Tutorial 3 - Matplotlib</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./pyTutorial4.html">
 <span class="dropdown-text">Tutorial 4 - Seaborn e GeoPandas</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./pyTutorial5.html">
 <span class="dropdown-text">Tutorial 5 - Quarto Dashboards em Python</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./pyTutorial5b.html">
 <span class="dropdown-text">Tutorial 5b - Mapas Interativos</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./pyTutorial5c.html">
 <span class="dropdown-text">Tutorial 5c - Dashboards Interativos</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./pyTutorial6.html">
 <span class="dropdown-text">Tutorial 6 - Métodos não supervisionados</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./pyTutorial7.html">
 <span class="dropdown-text">Tutorial 7 - Métodos de Regressão</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./pyTutorial8.html">
 <span class="dropdown-text">Tutorial 8 - Métodos de Classificação</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-tutoriais-r" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Tutoriais R</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-tutoriais-r">    
        <li>
    <a class="dropdown-item" href="./Tutorial0.html">
 <span class="dropdown-text">Tutorial 0 - Conhecendo o R</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./Tutorial1.html">
 <span class="dropdown-text">Tutorial 1 - Tidyverse</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./Tutorial2.html">
 <span class="dropdown-text">Tutorial 2 - Ggplot2 e Tidyverse</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./Tutorial_av_ggplot.html">
 <span class="dropdown-text">Tutorial 3a - Ggplot Avançado</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./Tutorial3b.html">
 <span class="dropdown-text">Tutorial 3b - Quarto Dashboards</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./Tutorial4.html">
 <span class="dropdown-text">Tutorial 4 - Métodos Não Supervisionados</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./Tutorial5regtidymodels.html">
 <span class="dropdown-text">Tutorial 5 - Métodos de Regressão e Classificação em R</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#lendo-os-dados" id="toc-lendo-os-dados" class="nav-link active" data-scroll-target="#lendo-os-dados">Lendo os dados</a></li>
  <li><a href="#juntando-os-dados" id="toc-juntando-os-dados" class="nav-link" data-scroll-target="#juntando-os-dados">Juntando os dados</a></li>
  <li><a href="#análise-exploratória-de-dados" id="toc-análise-exploratória-de-dados" class="nav-link" data-scroll-target="#análise-exploratória-de-dados">Análise Exploratória de Dados</a>
  <ul class="collapse">
  <li><a href="#quais-são-os-25-filmes-mais-avaliados" id="toc-quais-são-os-25-filmes-mais-avaliados" class="nav-link" data-scroll-target="#quais-são-os-25-filmes-mais-avaliados">Quais são os 25 filmes mais avaliados?</a></li>
  <li><a href="#quais-são-os-filmes-com-as-maiores-notas" id="toc-quais-são-os-filmes-com-as-maiores-notas" class="nav-link" data-scroll-target="#quais-são-os-filmes-com-as-maiores-notas">Quais são os filmes com as maiores notas?</a></li>
  <li><a href="#como-se-distribuem-as-idades" id="toc-como-se-distribuem-as-idades" class="nav-link" data-scroll-target="#como-se-distribuem-as-idades">Como se distribuem as idades?</a></li>
  <li><a href="#quais-são-os-filmes-que-mulheres-e-homens-mais-se-diferem-em-gostos" id="toc-quais-são-os-filmes-que-mulheres-e-homens-mais-se-diferem-em-gostos" class="nav-link" data-scroll-target="#quais-são-os-filmes-que-mulheres-e-homens-mais-se-diferem-em-gostos">Quais são os filmes que mulheres e homens mais se diferem em gostos ?</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Tutorial 2 - Pandas</h1>
<p class="subtitle lead">Usando Pandas com Movielens</p>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>Agora vamos realizar algumas análises mais interessantes.</p>
<div id="55aed96c" class="cell" data-execution_count="1">
<div class="cell-output cell-output-display" data-execution_count="1">
<p>Você pode baixar os dados aqui.</p><ul><li><a href="pydata2//users.csv" download="">users.csv</a></li><li><a href="pydata2//ratings.csv" download="">ratings.csv</a></li><li><a href="pydata2//movies.csv" download="">movies.csv</a></li></ul>
</div>
</div>
<div id="ca9dc9e1" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="lendo-os-dados" class="level1">
<h1>Lendo os dados</h1>
<div id="baa373f7" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>users <span class="op">=</span> pd.read_csv(<span class="st">'pydata2/users.csv'</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>users.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">user_id</th>
<th data-quarto-table-cell-role="th">age</th>
<th data-quarto-table-cell-role="th">sex</th>
<th data-quarto-table-cell-role="th">occupation</th>
<th data-quarto-table-cell-role="th">zip_code</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1</td>
<td>24</td>
<td>M</td>
<td>technician</td>
<td>85711</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2</td>
<td>53</td>
<td>F</td>
<td>other</td>
<td>94043</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>3</td>
<td>23</td>
<td>M</td>
<td>writer</td>
<td>32067</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>4</td>
<td>24</td>
<td>M</td>
<td>technician</td>
<td>43537</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>5</td>
<td>33</td>
<td>F</td>
<td>other</td>
<td>15213</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="dd6bf6f5" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>users.info()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 943 entries, 0 to 942
Data columns (total 5 columns):
 #   Column      Non-Null Count  Dtype 
---  ------      --------------  ----- 
 0   user_id     943 non-null    int64 
 1   age         943 non-null    int64 
 2   sex         943 non-null    object
 3   occupation  943 non-null    object
 4   zip_code    943 non-null    object
dtypes: int64(2), object(3)
memory usage: 37.0+ KB</code></pre>
</div>
</div>
<div id="413115ac" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>movies <span class="op">=</span> pd.read_csv(<span class="st">'pydata2/movies.csv'</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>movies.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">movie_id</th>
<th data-quarto-table-cell-role="th">title</th>
<th data-quarto-table-cell-role="th">release_date</th>
<th data-quarto-table-cell-role="th">video_release_date</th>
<th data-quarto-table-cell-role="th">imdb_url</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2</td>
<td>GoldenEye (1995)</td>
<td>01-Jan-1995</td>
<td>NaN</td>
<td>http://us.imdb.com/M/title-exact?GoldenEye%20(...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>3</td>
<td>Four Rooms (1995)</td>
<td>01-Jan-1995</td>
<td>NaN</td>
<td>http://us.imdb.com/M/title-exact?Four%20Rooms%...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>4</td>
<td>Get Shorty (1995)</td>
<td>01-Jan-1995</td>
<td>NaN</td>
<td>http://us.imdb.com/M/title-exact?Get%20Shorty%...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>5</td>
<td>Copycat (1995)</td>
<td>01-Jan-1995</td>
<td>NaN</td>
<td>http://us.imdb.com/M/title-exact?Copycat%20(1995)</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>6</td>
<td>Shanghai Triad (Yao a yao yao dao waipo qiao) ...</td>
<td>01-Jan-1995</td>
<td>NaN</td>
<td>http://us.imdb.com/Title?Yao+a+yao+yao+dao+wai...</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="56350b0d" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>movies.info()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 1681 entries, 0 to 1680
Data columns (total 5 columns):
 #   Column              Non-Null Count  Dtype  
---  ------              --------------  -----  
 0   movie_id            1681 non-null   int64  
 1   title               1681 non-null   object 
 2   release_date        1680 non-null   object 
 3   video_release_date  0 non-null      float64
 4   imdb_url            1678 non-null   object 
dtypes: float64(1), int64(1), object(3)
memory usage: 65.8+ KB</code></pre>
</div>
</div>
<div id="9065d139" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>ratings <span class="op">=</span> pd.read_csv(<span class="st">'pydata2/ratings.csv'</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>ratings.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">user_id</th>
<th data-quarto-table-cell-role="th">movie_id</th>
<th data-quarto-table-cell-role="th">rating</th>
<th data-quarto-table-cell-role="th">unix_timestamp</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>196</td>
<td>242</td>
<td>3</td>
<td>881250949</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>186</td>
<td>302</td>
<td>3</td>
<td>891717742</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>22</td>
<td>377</td>
<td>1</td>
<td>878887116</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>244</td>
<td>51</td>
<td>2</td>
<td>880606923</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>166</td>
<td>346</td>
<td>1</td>
<td>886397596</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="9aab9ea8" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>ratings.info()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 100000 entries, 0 to 99999
Data columns (total 4 columns):
 #   Column          Non-Null Count   Dtype
---  ------          --------------   -----
 0   user_id         100000 non-null  int64
 1   movie_id        100000 non-null  int64
 2   rating          100000 non-null  int64
 3   unix_timestamp  100000 non-null  int64
dtypes: int64(4)
memory usage: 3.1 MB</code></pre>
</div>
</div>
</section>
<section id="juntando-os-dados" class="level1">
<h1>Juntando os dados</h1>
<div id="292b466b" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>movie_ratings <span class="op">=</span> pd.merge(movies, ratings, how<span class="op">=</span><span class="st">'right'</span>)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>lens <span class="op">=</span> pd.merge(movie_ratings, users)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>lens.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">movie_id</th>
<th data-quarto-table-cell-role="th">title</th>
<th data-quarto-table-cell-role="th">release_date</th>
<th data-quarto-table-cell-role="th">video_release_date</th>
<th data-quarto-table-cell-role="th">imdb_url</th>
<th data-quarto-table-cell-role="th">user_id</th>
<th data-quarto-table-cell-role="th">rating</th>
<th data-quarto-table-cell-role="th">unix_timestamp</th>
<th data-quarto-table-cell-role="th">age</th>
<th data-quarto-table-cell-role="th">sex</th>
<th data-quarto-table-cell-role="th">occupation</th>
<th data-quarto-table-cell-role="th">zip_code</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>242</td>
<td>Kolya (1996)</td>
<td>24-Jan-1997</td>
<td>NaN</td>
<td>http://us.imdb.com/M/title-exact?Kolya%20(1996)</td>
<td>196</td>
<td>3</td>
<td>881250949</td>
<td>49</td>
<td>M</td>
<td>writer</td>
<td>55105</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>393</td>
<td>Mrs. Doubtfire (1993)</td>
<td>01-Jan-1993</td>
<td>NaN</td>
<td>http://us.imdb.com/M/title-exact?Mrs.%20Doubtf...</td>
<td>196</td>
<td>4</td>
<td>881251863</td>
<td>49</td>
<td>M</td>
<td>writer</td>
<td>55105</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>381</td>
<td>Muriel's Wedding (1994)</td>
<td>01-Jan-1994</td>
<td>NaN</td>
<td>http://us.imdb.com/M/title-exact?Muriel's%20We...</td>
<td>196</td>
<td>4</td>
<td>881251728</td>
<td>49</td>
<td>M</td>
<td>writer</td>
<td>55105</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>251</td>
<td>Shall We Dance? (1996)</td>
<td>11-Jul-1997</td>
<td>NaN</td>
<td>http://us.imdb.com/M/title-exact?Shall%20we%20...</td>
<td>196</td>
<td>3</td>
<td>881251274</td>
<td>49</td>
<td>M</td>
<td>writer</td>
<td>55105</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>655</td>
<td>Stand by Me (1986)</td>
<td>01-Jan-1986</td>
<td>NaN</td>
<td>http://us.imdb.com/M/title-exact?Stand%20by%20...</td>
<td>196</td>
<td>5</td>
<td>881251793</td>
<td>49</td>
<td>M</td>
<td>writer</td>
<td>55105</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="28a21ac9" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>lens.info()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 100000 entries, 0 to 99999
Data columns (total 12 columns):
 #   Column              Non-Null Count   Dtype  
---  ------              --------------   -----  
 0   movie_id            100000 non-null  int64  
 1   title               99548 non-null   object 
 2   release_date        99539 non-null   object 
 3   video_release_date  0 non-null       float64
 4   imdb_url            99535 non-null   object 
 5   user_id             100000 non-null  int64  
 6   rating              100000 non-null  int64  
 7   unix_timestamp      100000 non-null  int64  
 8   age                 100000 non-null  int64  
 9   sex                 100000 non-null  object 
 10  occupation          100000 non-null  object 
 11  zip_code            100000 non-null  object 
dtypes: float64(1), int64(5), object(6)
memory usage: 9.2+ MB</code></pre>
</div>
</div>
</section>
<section id="análise-exploratória-de-dados" class="level1">
<h1>Análise Exploratória de Dados</h1>
<section id="quais-são-os-25-filmes-mais-avaliados" class="level3">
<h3 class="anchored" data-anchor-id="quais-são-os-25-filmes-mais-avaliados">Quais são os 25 filmes mais avaliados?</h3>
<div id="ebd9f60d" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>best <span class="op">=</span> lens.groupby(<span class="st">'title'</span>).count().reset_index()[[<span class="st">'title'</span>,<span class="st">'movie_id'</span>]].rename(columns<span class="op">=</span>{<span class="st">'movie_id'</span>:<span class="st">'count'</span>}).sort_values(<span class="st">'count'</span>,</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>                ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>best.head(<span class="dv">25</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">title</th>
<th data-quarto-table-cell-role="th">count</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1398</td>
<td>Star Wars (1977)</td>
<td>583</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">333</td>
<td>Contact (1997)</td>
<td>509</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">498</td>
<td>Fargo (1996)</td>
<td>508</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1234</td>
<td>Return of the Jedi (1983)</td>
<td>507</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">860</td>
<td>Liar Liar (1997)</td>
<td>485</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">460</td>
<td>English Patient, The (1996)</td>
<td>481</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1284</td>
<td>Scream (1996)</td>
<td>478</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">32</td>
<td>Air Force One (1997)</td>
<td>431</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">744</td>
<td>Independence Day (ID4) (1996)</td>
<td>429</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1205</td>
<td>Raiders of the Lost Ark (1981)</td>
<td>420</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">612</td>
<td>Godfather, The (1972)</td>
<td>413</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1190</td>
<td>Pulp Fiction (1994)</td>
<td>394</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1542</td>
<td>Twelve Monkeys (1995)</td>
<td>392</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1329</td>
<td>Silence of the Lambs, The (1991)</td>
<td>390</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">780</td>
<td>Jerry Maguire (1996)</td>
<td>384</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">293</td>
<td>Chasing Amy (1997)</td>
<td>379</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1251</td>
<td>Rock, The (1996)</td>
<td>378</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">456</td>
<td>Empire Strikes Back, The (1980)</td>
<td>367</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1394</td>
<td>Star Trek: First Contact (1996)</td>
<td>365</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">113</td>
<td>Back to the Future (1985)</td>
<td>350</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1500</td>
<td>Titanic (1997)</td>
<td>350</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">987</td>
<td>Mission: Impossible (1996)</td>
<td>344</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">570</td>
<td>Fugitive, The (1993)</td>
<td>336</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">747</td>
<td>Indiana Jones and the Last Crusade (1989)</td>
<td>331</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1632</td>
<td>Willy Wonka and the Chocolate Factory (1971)</td>
<td>326</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Outra forma de fazer o mesmo (porém, neste caso retorna uma Pandas <code>series</code>:</p>
<div id="0b890afe" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>best2 <span class="op">=</span> lens.title.value_counts()[:<span class="dv">25</span>]</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>best2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<pre><code>title
Star Wars (1977)                                583
Contact (1997)                                  509
Fargo (1996)                                    508
Return of the Jedi (1983)                       507
Liar Liar (1997)                                485
English Patient, The (1996)                     481
Scream (1996)                                   478
Air Force One (1997)                            431
Independence Day (ID4) (1996)                   429
Raiders of the Lost Ark (1981)                  420
Godfather, The (1972)                           413
Pulp Fiction (1994)                             394
Twelve Monkeys (1995)                           392
Silence of the Lambs, The (1991)                390
Jerry Maguire (1996)                            384
Chasing Amy (1997)                              379
Rock, The (1996)                                378
Empire Strikes Back, The (1980)                 367
Star Trek: First Contact (1996)                 365
Back to the Future (1985)                       350
Titanic (1997)                                  350
Mission: Impossible (1996)                      344
Fugitive, The (1993)                            336
Indiana Jones and the Last Crusade (1989)       331
Willy Wonka and the Chocolate Factory (1971)    326
Name: count, dtype: int64</code></pre>
</div>
</div>
</section>
<section id="quais-são-os-filmes-com-as-maiores-notas" class="level3">
<h3 class="anchored" data-anchor-id="quais-são-os-filmes-com-as-maiores-notas">Quais são os filmes com as maiores notas?</h3>
<div id="a223a033" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>movie_stats <span class="op">=</span> lens.groupby(<span class="st">'title'</span>).agg({<span class="st">'occupation'</span>:<span class="st">'count'</span>,</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="st">'rating'</span>:<span class="st">'mean'</span>,<span class="st">'age'</span>:<span class="st">'mean'</span>}).sort_values(<span class="st">'rating'</span>, ascending<span class="op">=</span><span class="va">False</span>).rename(columns<span class="op">=</span>{<span class="st">'occupation'</span>:<span class="st">'count'</span>,<span class="st">'age'</span>:<span class="st">'mean_age'</span>}).<span class="bu">round</span>(decimals<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>movie_stats</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">count</th>
<th data-quarto-table-cell-role="th">rating</th>
<th data-quarto-table-cell-role="th">mean_age</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">title</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Santa with Muscles (1996)</td>
<td>2</td>
<td>5.0</td>
<td>26.50</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Saint of Fort Washington, The (1993)</td>
<td>2</td>
<td>5.0</td>
<td>24.00</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Prefontaine (1997)</td>
<td>3</td>
<td>5.0</td>
<td>29.00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Marlene Dietrich: Shadow and Light (1996)</td>
<td>1</td>
<td>5.0</td>
<td>60.00</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Someone Else's America (1995)</td>
<td>1</td>
<td>5.0</td>
<td>27.00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Man from Down Under, The (1943)</td>
<td>1</td>
<td>1.0</td>
<td>22.00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Good Morning (1971)</td>
<td>1</td>
<td>1.0</td>
<td>26.00</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Bird of Prey (1996)</td>
<td>1</td>
<td>1.0</td>
<td>26.00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Gordy (1995)</td>
<td>3</td>
<td>1.0</td>
<td>28.33</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Power 98 (1995)</td>
<td>1</td>
<td>1.0</td>
<td>47.00</td>
</tr>
</tbody>
</table>

<p>1663 rows × 3 columns</p>
</div>
</div>
</div>
<p>Os filmes acima são avaliados tão raramente, que nem podemos qualificá-los como top filmes. Que tal apenas olharmos os filmes que foram avaliados pelo menos 100 vezes.</p>
<div id="b0cbd042" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>movie_stats.query(<span class="st">'count &gt;= 100'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">count</th>
<th data-quarto-table-cell-role="th">rating</th>
<th data-quarto-table-cell-role="th">mean_age</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">title</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Close Shave, A (1995)</td>
<td>112</td>
<td>4.49</td>
<td>31.44</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Schindler's List (1993)</td>
<td>298</td>
<td>4.47</td>
<td>33.45</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Wrong Trousers, The (1993)</td>
<td>118</td>
<td>4.47</td>
<td>31.55</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Casablanca (1942)</td>
<td>243</td>
<td>4.46</td>
<td>35.90</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Shawshank Redemption, The (1994)</td>
<td>283</td>
<td>4.45</td>
<td>32.81</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Spawn (1997)</td>
<td>143</td>
<td>2.62</td>
<td>28.29</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Event Horizon (1997)</td>
<td>127</td>
<td>2.57</td>
<td>31.08</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Crash (1996)</td>
<td>128</td>
<td>2.55</td>
<td>32.45</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Jungle2Jungle (1997)</td>
<td>132</td>
<td>2.44</td>
<td>32.27</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Cable Guy, The (1996)</td>
<td>106</td>
<td>2.34</td>
<td>28.43</td>
</tr>
</tbody>
</table>

<p>337 rows × 3 columns</p>
</div>
</div>
</div>
<p>outra forma de fazer o mesmo:</p>
<div id="44e72ac4" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>atleast_100 <span class="op">=</span> movie_stats[<span class="st">'count'</span>] <span class="op">&gt;=</span> <span class="dv">100</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>atleast_100_movies <span class="op">=</span> movie_stats[atleast_100]</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>atleast_100_movies</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">count</th>
<th data-quarto-table-cell-role="th">rating</th>
<th data-quarto-table-cell-role="th">mean_age</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">title</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Close Shave, A (1995)</td>
<td>112</td>
<td>4.49</td>
<td>31.44</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Schindler's List (1993)</td>
<td>298</td>
<td>4.47</td>
<td>33.45</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Wrong Trousers, The (1993)</td>
<td>118</td>
<td>4.47</td>
<td>31.55</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Casablanca (1942)</td>
<td>243</td>
<td>4.46</td>
<td>35.90</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Shawshank Redemption, The (1994)</td>
<td>283</td>
<td>4.45</td>
<td>32.81</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Spawn (1997)</td>
<td>143</td>
<td>2.62</td>
<td>28.29</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Event Horizon (1997)</td>
<td>127</td>
<td>2.57</td>
<td>31.08</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Crash (1996)</td>
<td>128</td>
<td>2.55</td>
<td>32.45</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Jungle2Jungle (1997)</td>
<td>132</td>
<td>2.44</td>
<td>32.27</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Cable Guy, The (1996)</td>
<td>106</td>
<td>2.34</td>
<td>28.43</td>
</tr>
</tbody>
</table>

<p>337 rows × 3 columns</p>
</div>
</div>
</div>
</section>
<section id="como-se-distribuem-as-idades" class="level3">
<h3 class="anchored" data-anchor-id="como-se-distribuem-as-idades">Como se distribuem as idades?</h3>
<p>Vamos criar um gráfico mostrando a distribuição das idades.</p>
<p><code>pandas</code> tem um integração nativa com a biblioteca <code>matplotlib</code> que permite a plotagem de Series/DataFrames ficarem mais fáceis ainda. Neste caso apenas chamamos o método histo na coluna que queremos produzir o histograma. Nós podemos também chamar o <code>matplotlib.pyplot</code> para customizar o nosso gráfico um pouco. (sempre lembrar de rotular seus eixos!)</p>
<div id="82b02458" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>users.age.hist(bins<span class="op">=</span><span class="dv">30</span>)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Add title and labels</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Distribuição das idades'</span>)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Idades'</span>)</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Frequencia'</span>)</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Show the plot</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="pyTutorial2_files/figure-html/cell-17-output-1.png" width="593" height="450" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Eu não acho muito legal comparar nossas idades individuais, portanto vamos binarizar nossos usuários em groupos por idade usando o <code>pd.cut</code>.</p>
<div id="11288b54" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>labels <span class="op">=</span> [<span class="st">'0-9'</span>, <span class="st">'10-19'</span>, <span class="st">'20-29'</span>, <span class="st">'30-39'</span>, <span class="st">'40-49'</span>, <span class="st">'50-59'</span>, <span class="st">'60-69'</span>, <span class="st">'70-79'</span>]</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>lens[<span class="st">'age_group'</span>] <span class="op">=</span> pd.cut(lens.age, <span class="bu">range</span>(<span class="dv">0</span>, <span class="dv">81</span>, <span class="dv">10</span>), right<span class="op">=</span><span class="va">False</span>, labels<span class="op">=</span>labels)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>lens[[<span class="st">'title'</span>,<span class="st">'age'</span>,<span class="st">'age_group'</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">title</th>
<th data-quarto-table-cell-role="th">age</th>
<th data-quarto-table-cell-role="th">age_group</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Kolya (1996)</td>
<td>49</td>
<td>40-49</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Mrs. Doubtfire (1993)</td>
<td>49</td>
<td>40-49</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Muriel's Wedding (1994)</td>
<td>49</td>
<td>40-49</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Shall We Dance? (1996)</td>
<td>49</td>
<td>40-49</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Stand by Me (1986)</td>
<td>49</td>
<td>40-49</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">99995</td>
<td>City of Lost Children, The (1995)</td>
<td>20</td>
<td>20-29</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">99996</td>
<td>Heat (1995)</td>
<td>20</td>
<td>20-29</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">99997</td>
<td>NaN</td>
<td>20</td>
<td>20-29</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">99998</td>
<td>Liar Liar (1997)</td>
<td>20</td>
<td>20-29</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">99999</td>
<td>Waiting for Guffman (1996)</td>
<td>20</td>
<td>20-29</td>
</tr>
</tbody>
</table>

<p>100000 rows × 3 columns</p>
</div>
</div>
</div>
<p>Vimos que há uma valor ‘NaN’ no título, vamos conferior melhor:</p>
<div id="06c3edcb" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>lens.isna().<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="18">
<pre><code>movie_id                   0
title                    452
release_date             461
video_release_date    100000
imdb_url                 465
user_id                    0
rating                     0
unix_timestamp             0
age                        0
sex                        0
occupation                 0
zip_code                   0
age_group                  0
dtype: int64</code></pre>
</div>
</div>
<p>Vamos eliminar os ‘NaN’:</p>
<div id="bb4e9953" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>lens <span class="op">=</span> lens.dropna(subset<span class="op">=</span>[<span class="st">'title'</span>])</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>lens</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="19">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">movie_id</th>
<th data-quarto-table-cell-role="th">title</th>
<th data-quarto-table-cell-role="th">release_date</th>
<th data-quarto-table-cell-role="th">video_release_date</th>
<th data-quarto-table-cell-role="th">imdb_url</th>
<th data-quarto-table-cell-role="th">user_id</th>
<th data-quarto-table-cell-role="th">rating</th>
<th data-quarto-table-cell-role="th">unix_timestamp</th>
<th data-quarto-table-cell-role="th">age</th>
<th data-quarto-table-cell-role="th">sex</th>
<th data-quarto-table-cell-role="th">occupation</th>
<th data-quarto-table-cell-role="th">zip_code</th>
<th data-quarto-table-cell-role="th">age_group</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>242</td>
<td>Kolya (1996)</td>
<td>24-Jan-1997</td>
<td>NaN</td>
<td>http://us.imdb.com/M/title-exact?Kolya%20(1996)</td>
<td>196</td>
<td>3</td>
<td>881250949</td>
<td>49</td>
<td>M</td>
<td>writer</td>
<td>55105</td>
<td>40-49</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>393</td>
<td>Mrs. Doubtfire (1993)</td>
<td>01-Jan-1993</td>
<td>NaN</td>
<td>http://us.imdb.com/M/title-exact?Mrs.%20Doubtf...</td>
<td>196</td>
<td>4</td>
<td>881251863</td>
<td>49</td>
<td>M</td>
<td>writer</td>
<td>55105</td>
<td>40-49</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>381</td>
<td>Muriel's Wedding (1994)</td>
<td>01-Jan-1994</td>
<td>NaN</td>
<td>http://us.imdb.com/M/title-exact?Muriel's%20We...</td>
<td>196</td>
<td>4</td>
<td>881251728</td>
<td>49</td>
<td>M</td>
<td>writer</td>
<td>55105</td>
<td>40-49</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>251</td>
<td>Shall We Dance? (1996)</td>
<td>11-Jul-1997</td>
<td>NaN</td>
<td>http://us.imdb.com/M/title-exact?Shall%20we%20...</td>
<td>196</td>
<td>3</td>
<td>881251274</td>
<td>49</td>
<td>M</td>
<td>writer</td>
<td>55105</td>
<td>40-49</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>655</td>
<td>Stand by Me (1986)</td>
<td>01-Jan-1986</td>
<td>NaN</td>
<td>http://us.imdb.com/M/title-exact?Stand%20by%20...</td>
<td>196</td>
<td>5</td>
<td>881251793</td>
<td>49</td>
<td>M</td>
<td>writer</td>
<td>55105</td>
<td>40-49</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">99994</td>
<td>300</td>
<td>Air Force One (1997)</td>
<td>01-Jan-1997</td>
<td>NaN</td>
<td>http://us.imdb.com/M/title-exact?Air+Force+One...</td>
<td>941</td>
<td>4</td>
<td>875048495</td>
<td>20</td>
<td>M</td>
<td>student</td>
<td>97229</td>
<td>20-29</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">99995</td>
<td>919</td>
<td>City of Lost Children, The (1995)</td>
<td>01-Jan-1995</td>
<td>NaN</td>
<td>http://us.imdb.com/Title?Cit%E9+des+enfants+pe...</td>
<td>941</td>
<td>5</td>
<td>875048887</td>
<td>20</td>
<td>M</td>
<td>student</td>
<td>97229</td>
<td>20-29</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">99996</td>
<td>273</td>
<td>Heat (1995)</td>
<td>01-Jan-1995</td>
<td>NaN</td>
<td>http://us.imdb.com/M/title-exact?Heat%20(1995)</td>
<td>941</td>
<td>3</td>
<td>875049038</td>
<td>20</td>
<td>M</td>
<td>student</td>
<td>97229</td>
<td>20-29</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">99998</td>
<td>294</td>
<td>Liar Liar (1997)</td>
<td>21-Mar-1997</td>
<td>NaN</td>
<td>http://us.imdb.com/Title?Liar+Liar+(1997)</td>
<td>941</td>
<td>4</td>
<td>875048532</td>
<td>20</td>
<td>M</td>
<td>student</td>
<td>97229</td>
<td>20-29</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">99999</td>
<td>1007</td>
<td>Waiting for Guffman (1996)</td>
<td>31-Jan-1997</td>
<td>NaN</td>
<td>http://us.imdb.com/M/title-exact?Waiting%20for...</td>
<td>941</td>
<td>4</td>
<td>875049077</td>
<td>20</td>
<td>M</td>
<td>student</td>
<td>97229</td>
<td>20-29</td>
</tr>
</tbody>
</table>

<p>99548 rows × 13 columns</p>
</div>
</div>
</div>
<p>Vamos verificar a contagem e o rating médio por cada faixa etária:</p>
<div id="e2e3e47c" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>lens_age <span class="op">=</span> lens.groupby(<span class="st">'age_group'</span>).agg({<span class="st">'rating'</span>: <span class="st">'mean'</span>, <span class="st">'title'</span>:<span class="st">'count'</span>})</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>lens_age</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="20">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">rating</th>
<th data-quarto-table-cell-role="th">title</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">age_group</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0-9</td>
<td>3.767442</td>
<td>43</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">10-19</td>
<td>3.485511</td>
<td>8144</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">20-29</td>
<td>3.465155</td>
<td>39346</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">30-39</td>
<td>3.552180</td>
<td>25575</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">40-49</td>
<td>3.591265</td>
<td>14951</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">50-59</td>
<td>3.635389</td>
<td>8675</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">60-69</td>
<td>3.649351</td>
<td>2618</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">70-79</td>
<td>3.642857</td>
<td>196</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Jovens usuários tendem ser mais críticos que os outros grupos por faixa etária.</p>
<p>E vamos fazer um gráfico com estas informações.</p>
<div id="7208aecb" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>plt.bar(lens_age.index,lens_age[<span class="st">'rating'</span>])</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Rating médio por faixa etária"</span>)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="pyTutorial2_files/figure-html/cell-22-output-1.png" width="571" height="432" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Vamos olhar apenas para os 50 filmes mais avaliados e ver como eles são vistos por cada grupo.</p>
<div id="5e24dfc5" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>best50 <span class="op">=</span> atleast_100_movies.head(<span class="dv">50</span>)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>best50.info()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
Index: 50 entries, Close Shave, A (1995) to Apt Pupil (1998)
Data columns (total 3 columns):
 #   Column    Non-Null Count  Dtype  
---  ------    --------------  -----  
 0   count     50 non-null     int64  
 1   rating    50 non-null     float64
 2   mean_age  50 non-null     float64
dtypes: float64(2), int64(1)
memory usage: 1.6+ KB</code></pre>
</div>
</div>
<div id="6ef16447" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>best50.head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="23">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">count</th>
<th data-quarto-table-cell-role="th">rating</th>
<th data-quarto-table-cell-role="th">mean_age</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">title</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Close Shave, A (1995)</td>
<td>112</td>
<td>4.49</td>
<td>31.44</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Schindler's List (1993)</td>
<td>298</td>
<td>4.47</td>
<td>33.45</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Wrong Trousers, The (1993)</td>
<td>118</td>
<td>4.47</td>
<td>31.55</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Casablanca (1942)</td>
<td>243</td>
<td>4.46</td>
<td>35.90</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Shawshank Redemption, The (1994)</td>
<td>283</td>
<td>4.45</td>
<td>32.81</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="35abc13f" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>lens50 <span class="op">=</span> lens.set_index(<span class="st">'title'</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>lens50.info()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
Index: 99548 entries, Kolya (1996) to Waiting for Guffman (1996)
Data columns (total 12 columns):
 #   Column              Non-Null Count  Dtype   
---  ------              --------------  -----   
 0   movie_id            99548 non-null  int64   
 1   release_date        99539 non-null  object  
 2   video_release_date  0 non-null      float64 
 3   imdb_url            99535 non-null  object  
 4   user_id             99548 non-null  int64   
 5   rating              99548 non-null  int64   
 6   unix_timestamp      99548 non-null  int64   
 7   age                 99548 non-null  int64   
 8   sex                 99548 non-null  object  
 9   occupation          99548 non-null  object  
 10  zip_code            99548 non-null  object  
 11  age_group           99548 non-null  category
dtypes: category(1), float64(1), int64(5), object(5)
memory usage: 9.2+ MB</code></pre>
</div>
</div>
<div id="6280cf98" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>by_age <span class="op">=</span> lens50.loc[best50.index]</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>by_age.reset_index()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="25">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">title</th>
<th data-quarto-table-cell-role="th">movie_id</th>
<th data-quarto-table-cell-role="th">release_date</th>
<th data-quarto-table-cell-role="th">video_release_date</th>
<th data-quarto-table-cell-role="th">imdb_url</th>
<th data-quarto-table-cell-role="th">user_id</th>
<th data-quarto-table-cell-role="th">rating</th>
<th data-quarto-table-cell-role="th">unix_timestamp</th>
<th data-quarto-table-cell-role="th">age</th>
<th data-quarto-table-cell-role="th">sex</th>
<th data-quarto-table-cell-role="th">occupation</th>
<th data-quarto-table-cell-role="th">zip_code</th>
<th data-quarto-table-cell-role="th">age_group</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Close Shave, A (1995)</td>
<td>408</td>
<td>28-Apr-1996</td>
<td>NaN</td>
<td>http://us.imdb.com/M/title-exact?Close%20Shave...</td>
<td>305</td>
<td>5</td>
<td>886323189</td>
<td>23</td>
<td>M</td>
<td>programmer</td>
<td>94086</td>
<td>20-29</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Close Shave, A (1995)</td>
<td>408</td>
<td>28-Apr-1996</td>
<td>NaN</td>
<td>http://us.imdb.com/M/title-exact?Close%20Shave...</td>
<td>6</td>
<td>4</td>
<td>883599075</td>
<td>42</td>
<td>M</td>
<td>executive</td>
<td>98101</td>
<td>40-49</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Close Shave, A (1995)</td>
<td>408</td>
<td>28-Apr-1996</td>
<td>NaN</td>
<td>http://us.imdb.com/M/title-exact?Close%20Shave...</td>
<td>286</td>
<td>4</td>
<td>875806800</td>
<td>27</td>
<td>M</td>
<td>student</td>
<td>15217</td>
<td>20-29</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Close Shave, A (1995)</td>
<td>408</td>
<td>28-Apr-1996</td>
<td>NaN</td>
<td>http://us.imdb.com/M/title-exact?Close%20Shave...</td>
<td>303</td>
<td>4</td>
<td>879467035</td>
<td>19</td>
<td>M</td>
<td>student</td>
<td>14853</td>
<td>10-19</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Close Shave, A (1995)</td>
<td>408</td>
<td>28-Apr-1996</td>
<td>NaN</td>
<td>http://us.imdb.com/M/title-exact?Close%20Shave...</td>
<td>299</td>
<td>4</td>
<td>877877847</td>
<td>29</td>
<td>M</td>
<td>doctor</td>
<td>63108</td>
<td>20-29</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">11173</td>
<td>Apt Pupil (1998)</td>
<td>315</td>
<td>23-Oct-1998</td>
<td>NaN</td>
<td>http://us.imdb.com/Title?Apt+Pupil+(1998)</td>
<td>931</td>
<td>5</td>
<td>891037577</td>
<td>60</td>
<td>M</td>
<td>educator</td>
<td>33556</td>
<td>60-69</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11174</td>
<td>Apt Pupil (1998)</td>
<td>315</td>
<td>23-Oct-1998</td>
<td>NaN</td>
<td>http://us.imdb.com/Title?Apt+Pupil+(1998)</td>
<td>934</td>
<td>4</td>
<td>891188403</td>
<td>61</td>
<td>M</td>
<td>engineer</td>
<td>22902</td>
<td>60-69</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">11175</td>
<td>Apt Pupil (1998)</td>
<td>315</td>
<td>23-Oct-1998</td>
<td>NaN</td>
<td>http://us.imdb.com/Title?Apt+Pupil+(1998)</td>
<td>940</td>
<td>4</td>
<td>884801125</td>
<td>32</td>
<td>M</td>
<td>administrator</td>
<td>02215</td>
<td>30-39</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11176</td>
<td>Apt Pupil (1998)</td>
<td>315</td>
<td>23-Oct-1998</td>
<td>NaN</td>
<td>http://us.imdb.com/Title?Apt+Pupil+(1998)</td>
<td>942</td>
<td>4</td>
<td>891282355</td>
<td>48</td>
<td>F</td>
<td>librarian</td>
<td>78209</td>
<td>40-49</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">11177</td>
<td>Apt Pupil (1998)</td>
<td>315</td>
<td>23-Oct-1998</td>
<td>NaN</td>
<td>http://us.imdb.com/Title?Apt+Pupil+(1998)</td>
<td>926</td>
<td>4</td>
<td>888351623</td>
<td>49</td>
<td>M</td>
<td>entertainment</td>
<td>01701</td>
<td>40-49</td>
</tr>
</tbody>
</table>

<p>11178 rows × 13 columns</p>
</div>
</div>
</div>
<div id="b9bef7e4" class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>by_age.groupby([<span class="st">'title'</span>,<span class="st">'age_group'</span>]).agg({<span class="st">'rating'</span>: <span class="st">'mean'</span>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="26">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">rating</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">title</th>
<th data-quarto-table-cell-role="th">age_group</th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td rowspan="5" data-quarto-table-cell-role="th" data-valign="top">12 Angry Men (1957)</td>
<td data-quarto-table-cell-role="th">0-9</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">10-19</td>
<td>4.500000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">20-29</td>
<td>4.230769</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">30-39</td>
<td>4.382353</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">40-49</td>
<td>4.500000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
</tr>
<tr class="odd">
<td rowspan="5" data-quarto-table-cell-role="th" data-valign="top">Wrong Trousers, The (1993)</td>
<td data-quarto-table-cell-role="th">30-39</td>
<td>4.558824</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">40-49</td>
<td>4.538462</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">50-59</td>
<td>4.625000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">60-69</td>
<td>5.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">70-79</td>
<td>NaN</td>
</tr>
</tbody>
</table>

<p>400 rows × 1 columns</p>
</div>
</div>
</div>
</section>
<section id="quais-são-os-filmes-que-mulheres-e-homens-mais-se-diferem-em-gostos" class="level3">
<h3 class="anchored" data-anchor-id="quais-são-os-filmes-que-mulheres-e-homens-mais-se-diferem-em-gostos">Quais são os filmes que mulheres e homens mais se diferem em gostos ?</h3>
<div id="7a7ae33e" class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>lens.index</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="27">
<pre><code>Index([    0,     1,     2,     3,     4,     5,     6,     7,     8,     9,
       ...
       99989, 99990, 99991, 99992, 99993, 99994, 99995, 99996, 99998, 99999],
      dtype='int64', length=99548)</code></pre>
</div>
</div>
<div id="221dab43" class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>pivoted <span class="op">=</span> lens.pivot_table(index<span class="op">=</span>[<span class="st">'title'</span>], </span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>                           columns<span class="op">=</span>[<span class="st">'sex'</span>], </span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>                           values<span class="op">=</span><span class="st">'rating'</span>, </span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>                           fill_value<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>                           </span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>pivoted.head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="28">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">sex</th>
<th data-quarto-table-cell-role="th">F</th>
<th data-quarto-table-cell-role="th">M</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">title</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">'Til There Was You (1997)</td>
<td>2.200000</td>
<td>2.500000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1-900 (1994)</td>
<td>1.000000</td>
<td>3.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">101 Dalmatians (1996)</td>
<td>3.116279</td>
<td>2.772727</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">12 Angry Men (1957)</td>
<td>4.269231</td>
<td>4.363636</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">187 (1997)</td>
<td>3.500000</td>
<td>2.870968</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Vamos calcular a diferença entre as notas de homens e mulheres:</p>
<div id="c7185c01" class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>pivoted[<span class="st">'diff'</span>]<span class="op">=</span>pivoted.M <span class="op">-</span> pivoted.F</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>pivoted.head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="29">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">sex</th>
<th data-quarto-table-cell-role="th">F</th>
<th data-quarto-table-cell-role="th">M</th>
<th data-quarto-table-cell-role="th">diff</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">title</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">'Til There Was You (1997)</td>
<td>2.200000</td>
<td>2.500000</td>
<td>0.300000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1-900 (1994)</td>
<td>1.000000</td>
<td>3.000000</td>
<td>2.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">101 Dalmatians (1996)</td>
<td>3.116279</td>
<td>2.772727</td>
<td>-0.343552</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">12 Angry Men (1957)</td>
<td>4.269231</td>
<td>4.363636</td>
<td>0.094406</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">187 (1997)</td>
<td>3.500000</td>
<td>2.870968</td>
<td>-0.629032</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="5d87e245" class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>disagreements <span class="op">=</span> pivoted[pivoted.index.isin(best50.index)][<span class="st">'diff'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="4a368973" class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>disagreements_sorted <span class="op">=</span> disagreements.sort_values()</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>disagreements_sorted</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="31">
<pre><code>title
Sling Blade (1996)                                                            -0.284314
Philadelphia Story, The (1940)                                                -0.239583
Schindler's List (1993)                                                       -0.226519
It's a Wonderful Life (1946)                                                  -0.224182
Secrets &amp; Lies (1996)                                                         -0.212963
Graduate, The (1967)                                                          -0.198571
Close Shave, A (1995)                                                         -0.169213
Henry V (1989)                                                                -0.167255
Shawshank Redemption, The (1994)                                              -0.151541
Good Will Hunting (1997)                                                      -0.132911
To Kill a Mockingbird (1962)                                                  -0.081159
Taxi Driver (1976)                                                            -0.061303
Manchurian Candidate, The (1962)                                              -0.054348
Titanic (1997)                                                                -0.047139
Dr. Strangelove or: How I Learned to Stop Worrying and Love the Bomb (1963)   -0.044608
Silence of the Lambs, The (1991)                                              -0.040690
Psycho (1960)                                                                 -0.038637
Wrong Trousers, The (1993)                                                     0.028083
Braveheart (1995)                                                              0.031136
Rear Window (1954)                                                             0.048148
Usual Suspects, The (1995)                                                     0.065728
Cinema Paradiso (1988)                                                         0.071970
Casablanca (1942)                                                              0.073404
Chinatown (1974)                                                               0.087179
Killing Fields, The (1984)                                                     0.091039
12 Angry Men (1957)                                                            0.094406
Citizen Kane (1941)                                                            0.109337
Mr. Smith Goes to Washington (1939)                                            0.110000
As Good As It Gets (1997)                                                      0.119048
Boot, Das (1981)                                                               0.129814
L.A. Confidential (1997)                                                       0.146463
Star Wars (1977)                                                               0.153115
Amadeus (1984)                                                                 0.172094
Princess Bride, The (1987)                                                     0.176333
Great Escape, The (1963)                                                       0.182092
One Flew Over the Cuckoo's Nest (1975)                                         0.183333
Fargo (1996)                                                                   0.185044
Blade Runner (1982)                                                            0.192640
North by Northwest (1959)                                                      0.200366
Godfather, The (1972)                                                          0.201082
Raiders of the Lost Ark (1981)                                                 0.217328
Vertigo (1958)                                                                 0.231177
African Queen, The (1951)                                                      0.245614
Apt Pupil (1998)                                                               0.263323
Empire Strikes Back, The (1980)                                                0.300964
Godfather: Part II, The (1974)                                                 0.323521
Maltese Falcon, The (1941)                                                     0.355844
Lawrence of Arabia (1962)                                                      0.398715
Raging Bull (1980)                                                             0.471655
Bridge on the River Kwai, The (1957)                                           0.621978
Name: diff, dtype: float64</code></pre>
</div>
</div>
<div id="b4f55853" class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the horizontal bar plot</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>disagreements_sorted.plot(kind<span class="op">=</span><span class="st">'barh'</span>, figsize<span class="op">=</span>[<span class="dv">9</span>, <span class="dv">15</span>])</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Add title and labels</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Diferença Média no Rating</span><span class="ch">\n</span><span class="st">(Diferença &gt; 0 = Favoritado por homens)'</span>)</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Título'</span>)</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Diferença Média no Rating'</span>)</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Show the plot</span></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="pyTutorial2_files/figure-html/cell-33-output-1.png" width="1240" height="1209" class="figure-img"></p>
</figure>
</div>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      return note.innerHTML;
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>