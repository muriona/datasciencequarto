<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.527">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>EPS7008-UFSC - Tutorial 2 - Ggplot e Tidyverse</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">EPS7008-UFSC</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-tutoriais-python" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Tutoriais Python</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-tutoriais-python">    
        <li>
    <a class="dropdown-item" href="../pyTutorialPython.html">
 <span class="dropdown-text">Tutorial de Instalação do Python</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../pyTutorial1.html">
 <span class="dropdown-text">Tutorial 1 - Pandas</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../pyTutorial2.html">
 <span class="dropdown-text">Tutorial 2 - Pandas</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../pyTutorial3.html">
 <span class="dropdown-text">Tutorial 3 - Matplotlib</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../pyTutorial4.html">
 <span class="dropdown-text">Tutorial 4 - Seaborn e GeoPandas</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../pyTutorial5.html">
 <span class="dropdown-text">Tutorial 5 - Quarto Dashboards em Python</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../pyTutorial5b.html">
 <span class="dropdown-text">Tutorial 5b - Mapas Interativos</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../pyTutorial5c.html">
 <span class="dropdown-text">Tutorial 5c - Dashboards Interativos</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../pyTutorial6.html">
 <span class="dropdown-text">Tutorial 6 - Métodos não supervisionados</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../pyTutorial7.html">
 <span class="dropdown-text">Tutorial 7 - Métodos de Regressão</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../pyTutorial8.html">
 <span class="dropdown-text">Tutorial 8 - Métodos de Classificação</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-tutoriais-r" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Tutoriais R</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-tutoriais-r">    
        <li>
    <a class="dropdown-item" href="../Tutorial0.html">
 <span class="dropdown-text">Tutorial 0 - Conhecendo o R</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Tutorial1.html">
 <span class="dropdown-text">Tutorial 1 - Tidyverse</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Tutorial2.html">
 <span class="dropdown-text">Tutorial 2 - Ggplot2 e Tidyverse</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Tutorial_av_ggplot.html">
 <span class="dropdown-text">Tutorial 3a - Ggplot Avançado</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Tutorial3b.html">
 <span class="dropdown-text">Tutorial 3b - Quarto Dashboards</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Tutorial4.html">
 <span class="dropdown-text">Tutorial 4 - Métodos Não Supervisionados</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Tutorial5regtidymodels.html">
 <span class="dropdown-text">Tutorial 5 - Métodos de Regressão e Classificação em R</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#carregando-os-dados" id="toc-carregando-os-dados" class="nav-link active" data-scroll-target="#carregando-os-dados">Carregando os dados</a></li>
  <li><a href="#tipos-de-visualizações" id="toc-tipos-de-visualizações" class="nav-link" data-scroll-target="#tipos-de-visualizações">Tipos de visualizações</a></li>
  <li><a href="#gráfico-de-dispersão" id="toc-gráfico-de-dispersão" class="nav-link" data-scroll-target="#gráfico-de-dispersão">Gráfico de Dispersão</a>
  <ul class="collapse">
  <li><a href="#exemplo-base" id="toc-exemplo-base" class="nav-link" data-scroll-target="#exemplo-base">Exemplo Base</a></li>
  <li><a href="#adicionando-cores" id="toc-adicionando-cores" class="nav-link" data-scroll-target="#adicionando-cores">Adicionando cores</a></li>
  </ul></li>
  <li><a href="#gráfico-de-barras" id="toc-gráfico-de-barras" class="nav-link" data-scroll-target="#gráfico-de-barras">Gráfico de Barras</a>
  <ul class="collapse">
  <li><a href="#exemplo-base-1" id="toc-exemplo-base-1" class="nav-link" data-scroll-target="#exemplo-base-1">Exemplo Base</a></li>
  <li><a href="#mudando-os-eixos-e-adicionando-cores" id="toc-mudando-os-eixos-e-adicionando-cores" class="nav-link" data-scroll-target="#mudando-os-eixos-e-adicionando-cores">Mudando os eixos e adicionando cores</a></li>
  </ul></li>
  <li><a href="#gráfico-de-linha" id="toc-gráfico-de-linha" class="nav-link" data-scroll-target="#gráfico-de-linha">Gráfico de linha</a>
  <ul class="collapse">
  <li><a href="#exemplo-base-2" id="toc-exemplo-base-2" class="nav-link" data-scroll-target="#exemplo-base-2">Exemplo Base</a></li>
  <li><a href="#adicionando-mais-de-uma-linha" id="toc-adicionando-mais-de-uma-linha" class="nav-link" data-scroll-target="#adicionando-mais-de-uma-linha">Adicionando mais de uma linha</a></li>
  </ul></li>
  <li><a href="#gráfico-de-boxplot" id="toc-gráfico-de-boxplot" class="nav-link" data-scroll-target="#gráfico-de-boxplot">Gráfico de Boxplot</a>
  <ul class="collapse">
  <li><a href="#exemplo-base-3" id="toc-exemplo-base-3" class="nav-link" data-scroll-target="#exemplo-base-3">Exemplo Base</a></li>
  <li><a href="#adicionando-cores-por-meio-de-paletas-pré-definidas" id="toc-adicionando-cores-por-meio-de-paletas-pré-definidas" class="nav-link" data-scroll-target="#adicionando-cores-por-meio-de-paletas-pré-definidas">Adicionando cores por meio de paletas pré-definidas</a></li>
  </ul></li>
  <li><a href="#gráfico-de-histograma" id="toc-gráfico-de-histograma" class="nav-link" data-scroll-target="#gráfico-de-histograma">Gráfico de Histograma</a>
  <ul class="collapse">
  <li><a href="#exemplo-base-4" id="toc-exemplo-base-4" class="nav-link" data-scroll-target="#exemplo-base-4">Exemplo Base</a></li>
  <li><a href="#adicionando-cores-1" id="toc-adicionando-cores-1" class="nav-link" data-scroll-target="#adicionando-cores-1">Adicionando cores</a></li>
  </ul></li>
  <li><a href="#diagramas-sankey" id="toc-diagramas-sankey" class="nav-link" data-scroll-target="#diagramas-sankey">Diagramas Sankey</a></li>
  <li><a href="#outras-customizações" id="toc-outras-customizações" class="nav-link" data-scroll-target="#outras-customizações">Outras customizações</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Tutorial 2 - Ggplot e Tidyverse</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl) <span class="co"># para fazer leitura de arquivos excel</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr) <span class="co"># para formatar tabelas</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="carregando-os-dados" class="level1">
<h1>Carregando os dados</h1>
<p>Neste tutorial vamos aprender um pouco mais sobre o <code>ggplot</code> em conjunto com os outros pacotes do <code>tidyverse</code>.</p>
<p>Para praticar, vamos usar o dataset <code>netflix_series_limpo.xlsx</code>, o dataset <code>NetflixViewingHistory.csv</code> e o dataset <code>imdb_series.xlsx</code> e o dataset <code>imdb.rds</code> de filmes. Portanto, o primeiro passo será carregar os datasets:</p>
<pre><code></code></pre>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>netflix <span class="ot">&lt;-</span> <span class="fu">read_xlsx</span>(<span class="st">"netflix_series_limpo.xlsx"</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>imdb <span class="ot">&lt;-</span> <span class="fu">read_xlsx</span>(<span class="st">"imdb_series.xlsx"</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>imdb_filmes <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"imdb.rds"</span>) <span class="co">#está usando uma função do pacote readr do tidyverse</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>netflix_filmes <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"NetflixViewingHistory.csv"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(Title, <span class="fu">c</span>(<span class="st">"movie_title"</span>,<span class="st">"season"</span>,<span class="st">"episode"</span>),<span class="st">":"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(episode)) <span class="sc">%&gt;%</span> </span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(movie_title, Date) <span class="sc">%&gt;%</span> </span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Date =</span> lubridate<span class="sc">::</span><span class="fu">as_date</span>(Date, <span class="at">format=</span><span class="st">"%m/%d/%y"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(imdb_filmes, <span class="at">by=</span><span class="fu">c</span>(<span class="st">"movie_title"</span><span class="ot">=</span><span class="st">"titulo"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(id_filme))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 1429 Columns: 2
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (2): Title, Date

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expected 3 pieces. Additional pieces discarded in 77 rows [6, 7, 8, 9, 10, 13,
17, 18, 43, 44, 78, 97, 98, 99, 104, 161, 175, 176, 216, 282, ...].</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expected 3 pieces. Missing pieces filled with `NA` in 308 rows [5, 11, 12, 16,
19, 20, 31, 32, 33, 36, 37, 39, 40, 41, 42, 45, 46, 48, 49, 57, ...].</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in left_join(., imdb_filmes, by = c(movie_title = "titulo")): Detected an unexpected many-to-many relationship between `x` and `y`.
ℹ Row 5 of `x` matches multiple rows in `y`.
ℹ Row 88 of `y` matches multiple rows in `x`.
ℹ If a many-to-many relationship is expected, set `relationship =
  "many-to-many"` to silence this warning.</code></pre>
</div>
</div>
</section>
<section id="tipos-de-visualizações" class="level1">
<h1>Tipos de visualizações</h1>
<p>A visualização de dados é uma ferramenta poderosa que não só simplifica a compreensão de grandes volumes de dados, mas também desempenha um papel crucial na estatística aplicada e no aprendizado de máquina. Imagine o potencial de desbloquear insights valiosos e identificar padrões ocultos em seus conjuntos de dados! Com um conhecimento prévio do assunto, você pode explorar as nuances dos dados e revelar conexões significativas que podem surpreender e iluminar tanto você quanto sua audiência.</p>
<p><img src="images/types.png" class="img-fluid"></p>
</section>
<section id="gráfico-de-dispersão" class="level1">
<h1>Gráfico de Dispersão</h1>
<p>Quando há necessidade de encontrar correlações, são utilizados os gráficos de dispersão. Se existir um conjunto de dados XY, então um gráfico de dispersão é utilizado para encontrar a relação entre as variáveis X e Y.</p>
<section id="exemplo-base" class="level2">
<h2 class="anchored" data-anchor-id="exemplo-base">Exemplo Base</h2>
<p>Para realizar gráficos de dispersão, precisamos passar a função <code>geom_point()</code> como uma nova camada do <code>ggplot</code>. As coordenadas <code>x</code> e <code>y</code> devem ser numéricas necessariamente. Vamos usar como exemplo, o dataframe <code>imdb_filmes</code>.</p>
<p>No exemplo, a posição do ponto no eixo <code>x</code> pode ser dada pela coluna <code>orcamento</code> e a posição do ponto no eixo <code>y</code> pela coluna <code>receita</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>imdb_filmes <span class="sc">%&gt;%</span> </span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Tutorial2_files/figure-html/dispersao-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="adicionando-cores" class="level2">
<h2 class="anchored" data-anchor-id="adicionando-cores">Adicionando cores</h2>
<p>Podemos adicionar cores grupalmente para todos os pontos ou podemos usar alguma outra variável para criar cores em gradiente</p>
<p>Para ver mais detalhamento da função <code>geom_point()</code> recomenda-se a leitura do Capítulo 8 do Livro <a href="https://livro.curso-r.com/8-1-o-pacote-ggplot2.html#gr%C3%A1ficos-de-pontos-dispers%C3%A3o">“Curso-R”</a>.</p>
</section>
</section>
<section id="gráfico-de-barras" class="level1">
<h1>Gráfico de Barras</h1>
<p>Um gráfico de barras também exibe tendências ao longo do tempo. No caso de múltiplas variáveis, um gráfico de barras pode facilitar a comparação dos dados para cada variável em todos os momentos no tempo. Por exemplo, um gráfico de barras pode ser utilizado para comparar o crescimento da empresa ano a ano.</p>
<section id="exemplo-base-1" class="level2">
<h2 class="anchored" data-anchor-id="exemplo-base-1">Exemplo Base</h2>
<p>Para realizar gráficos de barras usamos <code>geom_col()</code>. Vamos usar o dataframe <code>imdb_filmes</code> para exemplificar, ordenando as linhas por ordem decrescente de <code>UserRating</code>. Primeiro vamos gerar o gráfico com as configuração padrão.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>imdb_filmes <span class="sc">%&gt;%</span> </span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(nota_imdb)) <span class="sc">%&gt;%</span> </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>)  <span class="co"># adicionar código do ggplot</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 20
   id_filme  titulo   ano data_lancamento generos duracao pais  idioma orcamento
   &lt;chr&gt;     &lt;chr&gt;  &lt;dbl&gt; &lt;chr&gt;           &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;      &lt;dbl&gt;
 1 tt102189… As I …  2019 2019-12-06      Drama,…      62 USA   Engli…     10000
 2 tt6735740 Love …  2019 2019-06-23      Comedy      100 USA   Engli…   3000000
 3 tt0111161 The S…  1994 1995-02-10      Drama       142 USA   Engli…  25000000
 4 tt0068646 The G…  1972 1972-09-21      Crime,…     175 USA   Engli…   6000000
 5 tt5980638 The T…  2018 2020-06-19      Music,…      96 USA   Engli…     90000
 6 tt0071562 The G…  1974 1975-09-25      Crime,…     202 USA   Engli…  13000000
 7 tt0050083 12 An…  1957 1957-09-04      Crime,…      96 USA   Engli…    350000
 8 tt0110912 Pulp …  1994 1994-10-28      Crime,…     154 USA   Engli…   8000000
 9 tt0108052 Schin…  1993 1994-03-11      Biogra…     195 USA   Engli…  22000000
10 tt0419781 Grave…  2005 2005-04-22      Thrill…      90 USA   Engli…   1930000
# ℹ 11 more variables: receita &lt;dbl&gt;, receita_eua &lt;dbl&gt;, nota_imdb &lt;dbl&gt;,
#   num_avaliacoes &lt;dbl&gt;, direcao &lt;chr&gt;, roteiro &lt;chr&gt;, producao &lt;chr&gt;,
#   elenco &lt;chr&gt;, descricao &lt;chr&gt;, num_criticas_publico &lt;dbl&gt;,
#   num_criticas_critica &lt;dbl&gt;</code></pre>
</div>
</div>
</section>
<section id="mudando-os-eixos-e-adicionando-cores" class="level2">
<h2 class="anchored" data-anchor-id="mudando-os-eixos-e-adicionando-cores">Mudando os eixos e adicionando cores</h2>
<p>Podemos mudar os eixos (trocar de eixo) usando a função <code>coord_flip()</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>imdb_filmes <span class="sc">%&gt;%</span> </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(nota_imdb)) <span class="sc">%&gt;%</span> </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 20
   id_filme  titulo   ano data_lancamento generos duracao pais  idioma orcamento
   &lt;chr&gt;     &lt;chr&gt;  &lt;dbl&gt; &lt;chr&gt;           &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;      &lt;dbl&gt;
 1 tt102189… As I …  2019 2019-12-06      Drama,…      62 USA   Engli…     10000
 2 tt6735740 Love …  2019 2019-06-23      Comedy      100 USA   Engli…   3000000
 3 tt0111161 The S…  1994 1995-02-10      Drama       142 USA   Engli…  25000000
 4 tt0068646 The G…  1972 1972-09-21      Crime,…     175 USA   Engli…   6000000
 5 tt5980638 The T…  2018 2020-06-19      Music,…      96 USA   Engli…     90000
 6 tt0071562 The G…  1974 1975-09-25      Crime,…     202 USA   Engli…  13000000
 7 tt0050083 12 An…  1957 1957-09-04      Crime,…      96 USA   Engli…    350000
 8 tt0110912 Pulp …  1994 1994-10-28      Crime,…     154 USA   Engli…   8000000
 9 tt0108052 Schin…  1993 1994-03-11      Biogra…     195 USA   Engli…  22000000
10 tt0419781 Grave…  2005 2005-04-22      Thrill…      90 USA   Engli…   1930000
# ℹ 11 more variables: receita &lt;dbl&gt;, receita_eua &lt;dbl&gt;, nota_imdb &lt;dbl&gt;,
#   num_avaliacoes &lt;dbl&gt;, direcao &lt;chr&gt;, roteiro &lt;chr&gt;, producao &lt;chr&gt;,
#   elenco &lt;chr&gt;, descricao &lt;chr&gt;, num_criticas_publico &lt;dbl&gt;,
#   num_criticas_critica &lt;dbl&gt;</code></pre>
</div>
</div>
<p>Vamos aplicar tudo o aprendido num segundo exemplo, usando o dataframe <code>imdb</code> para mostrar os seriados com maior número de votos <code>UserVotes</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>imdb <span class="sc">%&gt;%</span> </span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(series_name) <span class="sc">%&gt;%</span> </span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">Votos =</span> <span class="fu">sum</span>(UserVotes)) <span class="sc">%&gt;%</span> </span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(Votos)) <span class="co">#adicionar ggplot</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 27 × 2
   series_name                  Votos
   &lt;chr&gt;                        &lt;dbl&gt;
 1 The Walking Dead           2394586
 2 Arquivo X                   969628
 3 Friends                     853287
 4 Sobrenatural                499046
 5 Era Uma Vez                 397332
 6 Stranger Things             391288
 7 Sherlock                    373114
 8 Lúcifer                     298412
 9 Dark                        264631
10 Como Defender um Assassino  228352
# ℹ 17 more rows</code></pre>
</div>
</div>
<p>Você pode ver mais exemplos no Capítulo 8 do livro <a href="https://livro.curso-r.com/8-1-o-pacote-ggplot2.html#gr%C3%A1ficos-de-barras">Curso-R</a></p>
</section>
</section>
<section id="gráfico-de-linha" class="level1">
<h1>Gráfico de linha</h1>
<p>Gráficos de linhas são utilizados para exibir tendências ao longo do tempo. O eixo X é geralmente utilizado para representar um período, enquanto o eixo Y é utilizado para representar a quantidade associada ao período de tempo no eixo X. Por exemplo, um gráfico de linhas pode ilustrar o horário de pico de visitas em um shopping durante o dia, dividido por dias da semana e horas.</p>
<section id="exemplo-base-2" class="level2">
<h2 class="anchored" data-anchor-id="exemplo-base-2">Exemplo Base</h2>
<p>Vamos fazer um gráfico de linha usando a função <code>geom_line()</code> como camada do <code>ggplot</code> usando o dataset <code>netflix_filmes</code> para mostrar o total de capítulos assistidos por dia.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>netflix_filmes <span class="sc">%&gt;%</span>  <span class="co">#colocar código ggplot</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Date) <span class="sc">%&gt;%</span> </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">filmes=</span><span class="fu">n</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 114 × 2
   Date       filmes
   &lt;date&gt;      &lt;int&gt;
 1 2015-08-24      2
 2 2015-10-12      1
 3 2015-11-16      1
 4 2015-12-23      1
 5 2016-01-17      2
 6 2016-01-31      1
 7 2016-12-29      1
 8 2017-01-29      1
 9 2017-03-05      2
10 2017-03-12      1
# ℹ 104 more rows</code></pre>
</div>
</div>
<p>Podemos agrupar contagens usando a função <code>floor_date</code> do pacote <code>lubridate</code> para meses, trimestres, etc. Adicionalmente, podemos incluir cores.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>netflix_filmes <span class="sc">%&gt;%</span> </span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(<span class="at">mes =</span> lubridate<span class="sc">::</span><span class="fu">floor_date</span>(Date, <span class="st">"month"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 48 × 2
   mes            n
   &lt;date&gt;     &lt;int&gt;
 1 2015-08-01     2
 2 2015-10-01     1
 3 2015-11-01     1
 4 2015-12-01     1
 5 2016-01-01     3
 6 2016-12-01     1
 7 2017-01-01     1
 8 2017-03-01     3
 9 2017-05-01     1
10 2017-06-01     8
# ℹ 38 more rows</code></pre>
</div>
</div>
</section>
<section id="adicionando-mais-de-uma-linha" class="level2">
<h2 class="anchored" data-anchor-id="adicionando-mais-de-uma-linha">Adicionando mais de uma linha</h2>
<p>Vamos usar o dataset <code>imdb_filmes</code> para comparar o desempenho dos filmes (nota imdb) em função de ter lucro ou não. Vamos adicionar também uma camada extra para nos mostrar a tendência de ambas curvas, usando <code>geom_smooth()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>imdb_filmes <span class="sc">%&gt;%</span> </span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lucro =</span> receita <span class="sc">-</span> orcamento,</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">lucro_factor =</span> <span class="fu">ifelse</span>(lucro <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="st">"Sim"</span>,<span class="st">"Não"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(lucro)) <span class="sc">%&gt;%</span> </span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(lucro_factor,ano) <span class="sc">%&gt;%</span> </span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">nota_media=</span><span class="fu">mean</span>(nota_imdb,<span class="at">na.rm=</span><span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'lucro_factor'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 169 × 3
# Groups:   lucro_factor [2]
   lucro_factor   ano nota_media
   &lt;chr&gt;        &lt;dbl&gt;      &lt;dbl&gt;
 1 Não           1921       8.3 
 2 Não           1923       7   
 3 Não           1925       8.2 
 4 Não           1927       7.8 
 5 Não           1928       8.1 
 6 Não           1931       7.85
 7 Não           1932       7.9 
 8 Não           1933       7.65
 9 Não           1934       7.55
10 Não           1935       7.3 
# ℹ 159 more rows</code></pre>
</div>
</div>
<p>Você pode ver mais exemplos do <code>geom_line()</code> no livro <a href="https://livro.curso-r.com/8-1-o-pacote-ggplot2.html#gr%C3%A1ficos-de-linhas">Curso-R</a></p>
</section>
</section>
<section id="gráfico-de-boxplot" class="level1">
<h1>Gráfico de Boxplot</h1>
<p>Um gráfico de boxplot, também conhecido como diagrama de caixa, é uma ferramenta de visualização estatística que fornece uma representação compacta e informativa da distribuição de um conjunto de dados. Consiste em um retângulo (“caixa”) que se estende de um quartil ao outro, com uma linha vertical (ou “whisker”) estendendo-se de cada extremidade da caixa para representar a amplitude dos dados fora do intervalo interquartil.</p>
<section id="exemplo-base-3" class="level2">
<h2 class="anchored" data-anchor-id="exemplo-base-3">Exemplo Base</h2>
<p>Vamos usar os dados do dataset <code>imdb</code> para comparar as notas de <code>UserRating</code> em cada temporada do seriado <code>The Walking Dead</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>seriado_escolhido <span class="ot">&lt;-</span> <span class="st">"The Walking Dead"</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>imdb <span class="sc">%&gt;%</span> </span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(series_name <span class="sc">==</span> seriado_escolhido) <span class="sc">%&gt;%</span> </span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">7</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 288 × 4
   series_name      Episode                     season UserRating
   &lt;chr&gt;            &lt;chr&gt;                        &lt;dbl&gt;      &lt;dbl&gt;
 1 The Walking Dead Seed                             3        8.9
 2 The Walking Dead Sick                             3        8.6
 3 The Walking Dead Walk with Me                     3        8.2
 4 The Walking Dead Killer Within                    3        9.3
 5 The Walking Dead Say the Word                     3        8.2
 6 The Walking Dead Hounded                          3        8.3
 7 The Walking Dead When the Dead Come Knocking      3        8.6
 8 The Walking Dead Made to Suffer                   3        9  
 9 The Walking Dead The Suicide King                 3        8.2
10 The Walking Dead Home                             3        8.7
# ℹ 278 more rows</code></pre>
</div>
</div>
</section>
<section id="adicionando-cores-por-meio-de-paletas-pré-definidas" class="level2">
<h2 class="anchored" data-anchor-id="adicionando-cores-por-meio-de-paletas-pré-definidas">Adicionando cores por meio de paletas pré-definidas</h2>
<p>Vamos adicionar cores para cada temporada, para isto precisamos incluir o argumento <code>fill</code> dentro da camada de estetica <code>aes</code>. Podemos também escolher as cores de paletas pré-definidas como: <code>scale_fill_viridis_d()</code> e <code>scale_fill_brewer()</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>imdb <span class="sc">%&gt;%</span> </span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(series_name <span class="sc">==</span> seriado_escolhido) <span class="sc">%&gt;%</span> </span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">7</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 288 × 4
   series_name      Episode                     season UserRating
   &lt;chr&gt;            &lt;chr&gt;                        &lt;dbl&gt;      &lt;dbl&gt;
 1 The Walking Dead Seed                             3        8.9
 2 The Walking Dead Sick                             3        8.6
 3 The Walking Dead Walk with Me                     3        8.2
 4 The Walking Dead Killer Within                    3        9.3
 5 The Walking Dead Say the Word                     3        8.2
 6 The Walking Dead Hounded                          3        8.3
 7 The Walking Dead When the Dead Come Knocking      3        8.6
 8 The Walking Dead Made to Suffer                   3        9  
 9 The Walking Dead The Suicide King                 3        8.2
10 The Walking Dead Home                             3        8.7
# ℹ 278 more rows</code></pre>
</div>
</div>
</section>
</section>
<section id="gráfico-de-histograma" class="level1">
<h1>Gráfico de Histograma</h1>
<p>Um histograma representa dados usando barras de alturas diferentes. Geralmente, cada barra agrupa números em intervalos em um histograma. Quanto mais alta as barras, mais dados se encaixam nesse intervalo. É usado para exibir a forma e a dispersão de amostras de um conjunto de dados contínuos. Por exemplo, podemos usar um histograma para medir as frequências de cada resposta em uma pergunta de pesquisa. As barras representariam as respostas: “ruim”, “bom” e “ótimo”.</p>
<p>O Histograma serve para observar a distribuição dos dados e eventualmente serve para comparar mais de uma distribuição.</p>
<section id="exemplo-base-4" class="level2">
<h2 class="anchored" data-anchor-id="exemplo-base-4">Exemplo Base</h2>
<p>Vamos continuar com os dados sobre <code>UserRating</code> usados anteriormente para graficar Boxplots. Neste caso, vamos graficar a distribuição do <code>UserRating</code> considerando apenas a contagem. Podemos usar o argumento <code>bins</code> ou <code>binwidth</code> para ajustar melhor o resultado.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>imdb <span class="sc">%&gt;%</span> </span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(series_name <span class="sc">==</span> seriado_escolhido) <span class="sc">%&gt;%</span> </span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">7</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 288 × 4
   series_name      Episode                     season UserRating
   &lt;chr&gt;            &lt;chr&gt;                        &lt;dbl&gt;      &lt;dbl&gt;
 1 The Walking Dead Seed                             3        8.9
 2 The Walking Dead Sick                             3        8.6
 3 The Walking Dead Walk with Me                     3        8.2
 4 The Walking Dead Killer Within                    3        9.3
 5 The Walking Dead Say the Word                     3        8.2
 6 The Walking Dead Hounded                          3        8.3
 7 The Walking Dead When the Dead Come Knocking      3        8.6
 8 The Walking Dead Made to Suffer                   3        9  
 9 The Walking Dead The Suicide King                 3        8.2
10 The Walking Dead Home                             3        8.7
# ℹ 278 more rows</code></pre>
</div>
</div>
<p>Agora, vamos usar o dataset <code>imdb_filmes</code> para verificar quão lucrativo é um determinado genero.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>genero_escolhido <span class="ot">&lt;-</span> <span class="st">"Comedy"</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>imdb_filmes <span class="sc">%&gt;%</span> </span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">#filter(str_detect(string = generos, pattern = genero_escolhido)) %&gt;% </span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(generos <span class="sc">==</span> genero_escolhido) <span class="sc">%&gt;%</span> </span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lucro =</span> receita <span class="sc">-</span> orcamento)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 560 × 21
   id_filme  titulo   ano data_lancamento generos duracao pais  idioma orcamento
   &lt;chr&gt;     &lt;chr&gt;  &lt;dbl&gt; &lt;chr&gt;           &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;      &lt;dbl&gt;
 1 tt0183505 Me, M…  2000 2000-09-08      Comedy      116 USA   Engli…  51000000
 2 tt1242423 Dear …  2009 2011-07-01      Comedy       87 USA   Engli…        NA
 3 tt0120434 Vegas…  1997 1997-02-14      Comedy       93 USA   Engli…  25000000
 4 tt5617916 Airpl…  2019 2019-08-02      Comedy       80 USA   Engli…        NA
 5 tt7054636 A Mad…  2019 2019-03-01      Comedy      109 USA   Engli…  20000000
 6 tt0460925 The S…  2006 2006-01-01      Comedy       86 USA   Engli…        NA
 7 tt0071514 For P…  1974 1974-09-13      Comedy       90 USA   Engli…        NA
 8 tt0064683 Mondo…  1969 1969-03-14      Comedy       95 USA   Engli…      2100
 9 tt1073498 Meet …  2008 2008-04-24      Comedy       87 USA   Engli…  30000000
10 tt0489085 I-See…  2006 2006-03-08      Comedy       92 USA   Engli…   6200000
# ℹ 550 more rows
# ℹ 12 more variables: receita &lt;dbl&gt;, receita_eua &lt;dbl&gt;, nota_imdb &lt;dbl&gt;,
#   num_avaliacoes &lt;dbl&gt;, direcao &lt;chr&gt;, roteiro &lt;chr&gt;, producao &lt;chr&gt;,
#   elenco &lt;chr&gt;, descricao &lt;chr&gt;, num_criticas_publico &lt;dbl&gt;,
#   num_criticas_critica &lt;dbl&gt;, lucro &lt;dbl&gt;</code></pre>
</div>
</div>
</section>
<section id="adicionando-cores-1" class="level2">
<h2 class="anchored" data-anchor-id="adicionando-cores-1">Adicionando cores</h2>
<p>Podemos melhorar a apresentação, escolhendo cores diferentes adicionando o argumento <code>fill</code> dentro de <code>geom_histogram()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>imdb_filmes <span class="sc">%&gt;%</span> </span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">#filter(str_detect(string = generos, pattern = genero_escolhido)) %&gt;% </span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(generos <span class="sc">==</span> genero_escolhido) <span class="sc">%&gt;%</span> </span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lucro =</span> receita <span class="sc">-</span> orcamento) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 560 × 21
   id_filme  titulo   ano data_lancamento generos duracao pais  idioma orcamento
   &lt;chr&gt;     &lt;chr&gt;  &lt;dbl&gt; &lt;chr&gt;           &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;      &lt;dbl&gt;
 1 tt0183505 Me, M…  2000 2000-09-08      Comedy      116 USA   Engli…  51000000
 2 tt1242423 Dear …  2009 2011-07-01      Comedy       87 USA   Engli…        NA
 3 tt0120434 Vegas…  1997 1997-02-14      Comedy       93 USA   Engli…  25000000
 4 tt5617916 Airpl…  2019 2019-08-02      Comedy       80 USA   Engli…        NA
 5 tt7054636 A Mad…  2019 2019-03-01      Comedy      109 USA   Engli…  20000000
 6 tt0460925 The S…  2006 2006-01-01      Comedy       86 USA   Engli…        NA
 7 tt0071514 For P…  1974 1974-09-13      Comedy       90 USA   Engli…        NA
 8 tt0064683 Mondo…  1969 1969-03-14      Comedy       95 USA   Engli…      2100
 9 tt1073498 Meet …  2008 2008-04-24      Comedy       87 USA   Engli…  30000000
10 tt0489085 I-See…  2006 2006-03-08      Comedy       92 USA   Engli…   6200000
# ℹ 550 more rows
# ℹ 12 more variables: receita &lt;dbl&gt;, receita_eua &lt;dbl&gt;, nota_imdb &lt;dbl&gt;,
#   num_avaliacoes &lt;dbl&gt;, direcao &lt;chr&gt;, roteiro &lt;chr&gt;, producao &lt;chr&gt;,
#   elenco &lt;chr&gt;, descricao &lt;chr&gt;, num_criticas_publico &lt;dbl&gt;,
#   num_criticas_critica &lt;dbl&gt;, lucro &lt;dbl&gt;</code></pre>
</div>
</div>
<p>Você pode ver mais exemplos do Histogramas e Boxplots no Cap. 8 do livro <a href="https://livro.curso-r.com/8-1-o-pacote-ggplot2.html#histogramas-e-boxplots">Curso-R</a></p>
<p>Podemos usar alternativamente um outro tipo de visualização muito similar, que é a <code>geom_density()</code>. Vamos usar os mesmos exemplos anteriores.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>imdb <span class="sc">%&gt;%</span> </span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(series_name <span class="sc">==</span> seriado_escolhido) <span class="sc">%&gt;%</span> </span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 288 × 4
   series_name      Episode                     season UserRating
   &lt;chr&gt;            &lt;chr&gt;                        &lt;dbl&gt;      &lt;dbl&gt;
 1 The Walking Dead Seed                             3        8.9
 2 The Walking Dead Sick                             3        8.6
 3 The Walking Dead Walk with Me                     3        8.2
 4 The Walking Dead Killer Within                    3        9.3
 5 The Walking Dead Say the Word                     3        8.2
 6 The Walking Dead Hounded                          3        8.3
 7 The Walking Dead When the Dead Come Knocking      3        8.6
 8 The Walking Dead Made to Suffer                   3        9  
 9 The Walking Dead The Suicide King                 3        8.2
10 The Walking Dead Home                             3        8.7
# ℹ 278 more rows</code></pre>
</div>
</div>
<p>Podemos também customizar a cor da linha e da área abaixo da densidade usando os argumentos <code>fill</code> e <code>color</code> dentro do <code>geom_density()</code> bem como a transparência usando <code>alpha</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>imdb_filmes <span class="sc">%&gt;%</span> </span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">#filter(str_detect(string = generos, pattern = genero_escolhido)) %&gt;% </span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(generos <span class="sc">==</span> genero_escolhido) <span class="sc">%&gt;%</span> </span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lucro =</span> receita <span class="sc">-</span> orcamento)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 560 × 21
   id_filme  titulo   ano data_lancamento generos duracao pais  idioma orcamento
   &lt;chr&gt;     &lt;chr&gt;  &lt;dbl&gt; &lt;chr&gt;           &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;      &lt;dbl&gt;
 1 tt0183505 Me, M…  2000 2000-09-08      Comedy      116 USA   Engli…  51000000
 2 tt1242423 Dear …  2009 2011-07-01      Comedy       87 USA   Engli…        NA
 3 tt0120434 Vegas…  1997 1997-02-14      Comedy       93 USA   Engli…  25000000
 4 tt5617916 Airpl…  2019 2019-08-02      Comedy       80 USA   Engli…        NA
 5 tt7054636 A Mad…  2019 2019-03-01      Comedy      109 USA   Engli…  20000000
 6 tt0460925 The S…  2006 2006-01-01      Comedy       86 USA   Engli…        NA
 7 tt0071514 For P…  1974 1974-09-13      Comedy       90 USA   Engli…        NA
 8 tt0064683 Mondo…  1969 1969-03-14      Comedy       95 USA   Engli…      2100
 9 tt1073498 Meet …  2008 2008-04-24      Comedy       87 USA   Engli…  30000000
10 tt0489085 I-See…  2006 2006-03-08      Comedy       92 USA   Engli…   6200000
# ℹ 550 more rows
# ℹ 12 more variables: receita &lt;dbl&gt;, receita_eua &lt;dbl&gt;, nota_imdb &lt;dbl&gt;,
#   num_avaliacoes &lt;dbl&gt;, direcao &lt;chr&gt;, roteiro &lt;chr&gt;, producao &lt;chr&gt;,
#   elenco &lt;chr&gt;, descricao &lt;chr&gt;, num_criticas_publico &lt;dbl&gt;,
#   num_criticas_critica &lt;dbl&gt;, lucro &lt;dbl&gt;</code></pre>
</div>
</div>
<p>E por fim, podemos comparar duas ou mais categorias. Vamos fazer isso, comparando os generos “Comedy” e “Drama” para saber se há diferenças significativas em termos de lucro. Para isto, vamos incluir o argumento <code>group</code> dentro da camada <code>aes</code> além de <code>fill</code> e <code>color</code>. Adicionalmente podemos incluir <code>alpha</code> dentro de <code>geom_density()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>imdb_filmes <span class="sc">%&gt;%</span> </span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">#filter(str_detect(string = generos, pattern = genero_escolhido)) %&gt;% </span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(generos <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Comedy"</span>,<span class="st">"Drama"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lucro =</span> receita <span class="sc">-</span> orcamento)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,188 × 21
   id_filme  titulo   ano data_lancamento generos duracao pais  idioma orcamento
   &lt;chr&gt;     &lt;chr&gt;  &lt;dbl&gt; &lt;chr&gt;           &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;      &lt;dbl&gt;
 1 tt0183505 Me, M…  2000 2000-09-08      Comedy      116 USA   Engli…  51000000
 2 tt3703836 Henry…  2015 2016-01-08      Drama        87 USA   Engli…        NA
 3 tt1142798 The F…  2008 2008-09-12      Drama       111 USA   Engli…        NA
 4 tt1242423 Dear …  2009 2011-07-01      Comedy       87 USA   Engli…        NA
 5 tt0109514 Curse…  1994 1995-05-05      Drama       102 USA   Engli…  12577385
 6 tt0120434 Vegas…  1997 1997-02-14      Comedy       93 USA   Engli…  25000000
 7 tt0068528 The E…  1972 1973-05-30      Drama       100 USA   Engli…        NA
 8 tt5617916 Airpl…  2019 2019-08-02      Comedy       80 USA   Engli…        NA
 9 tt0049800 Storm…  1956 1956-07-31      Drama        85 USA   Engli…        NA
10 tt7054636 A Mad…  2019 2019-03-01      Comedy      109 USA   Engli…  20000000
# ℹ 1,178 more rows
# ℹ 12 more variables: receita &lt;dbl&gt;, receita_eua &lt;dbl&gt;, nota_imdb &lt;dbl&gt;,
#   num_avaliacoes &lt;dbl&gt;, direcao &lt;chr&gt;, roteiro &lt;chr&gt;, producao &lt;chr&gt;,
#   elenco &lt;chr&gt;, descricao &lt;chr&gt;, num_criticas_publico &lt;dbl&gt;,
#   num_criticas_critica &lt;dbl&gt;, lucro &lt;dbl&gt;</code></pre>
</div>
</div>
</section>
</section>
<section id="diagramas-sankey" class="level1">
<h1>Diagramas Sankey</h1>
<p>Diagramas Sankey são representações visuais que mostram o fluxo de dados, energia, recursos ou informações através de caminhos ou processos. Eles consistem em setas de larguras variáveis, onde a largura das setas é proporcional à quantidade de fluxo, facilitando a compreensão e análise de sistemas complexos de fluxo.</p>
<p><img src="images/sankey.png" class="img-fluid"></p>
</section>
<section id="outras-customizações" class="level1">
<h1>Outras customizações</h1>
<p>O ggplot inclui praticamente customizações infinitas, desde as mais simples, como atribuir títulos aos eixos até mudar as escalas, por exemplo usando transformações logarítmicas.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>imdb_filmes <span class="sc">%&gt;%</span> </span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lucro =</span> receita<span class="sc">-</span>orcamento) <span class="sc">%&gt;%</span> </span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> orcamento, <span class="at">y =</span> receita, <span class="at">color=</span>lucro)) <span class="sc">+</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha=</span><span class="fl">0.5</span>)<span class="sc">+</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_log10</span>()<span class="sc">+</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>()<span class="sc">+</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se=</span><span class="cn">FALSE</span>)<span class="sc">+</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_gradient</span>(<span class="at">low =</span> <span class="st">"red"</span>, <span class="at">high =</span> <span class="st">"green"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in scale_x_log10(): log-10 transformation introduced infinite values.
log-10 transformation introduced infinite values.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 7004 rows containing non-finite outside the scale range
(`stat_smooth()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: The following aesthetics were dropped during statistical transformation:
colour.
ℹ This can happen when ggplot fails to infer the correct grouping structure in
  the data.
ℹ Did you forget to specify a `group` aesthetic or to convert a numerical
  variable into a factor?</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 7004 rows containing missing values or values outside the scale range
(`geom_point()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Tutorial2_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      return note.innerHTML;
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>